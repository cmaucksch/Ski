<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ski Tracker</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f4f4f4;
    }
    .ski-item {
        background: white;
        padding: 15px;
        margin-bottom: 12px;
        border-radius: 10px;
        position: relative;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .title {
        font-size: 20px;
        font-weight: bold;
    }
    .count {
        font-size: 32px;
        margin: 10px 0;
    }
    .btn {
        padding: 8px 14px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        margin-right: 6px;
        font-size: 16px;
    }
    .plus-btn { background: #007bff; color: white; }
    .service-btn { background: #444; color: white; }
    .delete-btn {
        position: absolute;
        right: 12px;
        top: 10px;
        background: none;
        border: none;
        font-size: 22px;
        cursor: pointer;
        color: #900;
    }
</style>
</head>
<body>

<h2>Ski Tracker 2025</h2>

<input type="text" id="gebietInput" placeholder="Neues Gebiet…" />
<button onclick="addGebiet()">Hinzufügen</button>
<br><br>

<!-- Import -->
<input type="file" id="importFile" accept=".csv">
<button onclick="importCSV()">Importieren</button>
<button onclick="exportCSV()">Exportieren</button>

<br><br>

<div id="skiList"></div>

<script>
/* ---------------- Farbeinstellungen ---------------- */
const farben = ["#fff", "#ffcccc", "#ffe6b3", "#ffffcc", "#ccffcc", "#cce6ff", "#e6ccff"];
// Index 0 ist weiß → nach Service wird weiß gesetzt → nächster Klick = Farbe 1

/* ---------------- Datenhaltung ---------------- */
let skidata = [];

/* ---------------- Gebiet hinzufügen ---------------- */
function addGebiet() {
    const name = document.getElementById("gebietInput").value.trim();
    if (!name) return;

    skidata.push({ name, tage: 0, colorIndex: 0 });
    document.getElementById("gebietInput").value = "";
    render();
}

/* ---------------- Plus-Klick ---------------- */
function addTag(index) {
    skidata[index].tage++;
    // Farbe erhöhen, aber innerhalb Array
    skidata[index].colorIndex = (skidata[index].colorIndex + 1) % farben.length;
    render();
}

/* ---------------- Service-Button ---------------- */
function resetColor(index) {
    skidata[index].colorIndex = 0; // Weiß
    render();
}

/* ---------------- Löschen ---------------- */
function deleteGebiet(index) {
    skidata.splice(index, 1);
    render();
}

/* ---------------- Darstellung ---------------- */
function render() {
    const list = document.getElementById("skiList");
    list.innerHTML = "";

    skidata.forEach((item, i) => {
        const box = document.createElement("div");
        box.className = "ski-item";
        box.style.background = farben[item.colorIndex];

        box.innerHTML = `
            <button class="delete-btn" onclick="deleteGebiet(${i})">×</button>
            <div class="title">${item.name}</div>
            <div class="count">${item.tage} Skitage</div>
            <button class="btn plus-btn" onclick="addTag(${i})">+1</button>
            <button class="btn service-btn" onclick="resetColor(${i})">Service</button>
        `;

        list.appendChild(box);
    });
}

/* ---------------- Export ---------------- */
function exportCSV() {
    let csv = "Gebiet;Tage;Farbe\n";
    skidata.forEach(i => {
        csv += `${i.name};${i.tage};${i.colorIndex}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "Ski_Tracker_2025.csv";
    a.click();
}

/* ---------------- Import ---------------- */
function importCSV() {
    const file = document.getElementById("importFile").files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        const lines = reader.result.split("\n").slice(1); // erste Zeile Header raus

        skidata = [];
        for (let line of lines) {
            if (!line.trim()) continue;
            const parts = line.split(";");

            // FIX: richtiger Import der Werte, ohne zusätzlichen Tag
            skidata.push({
                name: parts[0],
                tage: Number(parts[1] || 0),
                colorIndex: Number(parts[2] || 0)
            });
        }
        render();
    };
    reader.readAsText(file);
}
</script>

</body>
</html>
